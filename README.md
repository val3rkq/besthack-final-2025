# Geocoder API

API для геокодирования, обратного геокодирования и оценки сходства адресов. Проект разработан для хакатона Best Hack x RWB DS.

## Описание

Geocoder API предоставляет RESTful интерфейс для работы с адресами:
- **Поиск адресов** по текстовому запросу с использованием комбинации алгоритмов Дамерау-Левенштейна и BM25
- **Обратное геокодирование** - определение адресов по координатам (широта/долгота)
- **Сравнение адресов** - оценка сходства и расстояния между двумя адресами

## Технологии

- **Python** - основной ЯП
- **FastAPI** - современный веб-фреймворк для создания API
- **Golang** - ЯП, использованный для конвертации датасета из osm.pbf в csv
- **rapidfuzz** - реализация алгоритма Дамерау-Левенштейна
- **rank-bm25** - реализация алгоритма BM25 для текстового поиска

## Установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url> 
cd besthack-final-2025
```

2. Соберите Docker-контейнер:
```
docker build -t besthack .
```

## Запуск

Запустите Docker-контейнер:
```
docker run -p 8000:8000 -v "$(pwd):/workspace" besthack
```

Интерактивная документация (Swagger UI): http://localhost:8000/docs

Веб-интерфейс: http://localhost:8000/

## API Эндпоинты

### 1. Поиск адресов (`POST /search`)

Поиск топ-N наиболее похожих адресов по текстовому запросу.

Параметры:
- query (string, обязательный) - текстовый запрос адреса
- top_n (int, по умолчанию 5) - количество возвращаемых результатов
- weights (object, опционально) - веса алгоритмов:
  - dl (float, по умолчанию 1.0) - вес алгоритма Дамерау-Левенштейна
  - bm25 (float, по умолчанию 1.0) - вес алгоритма BM25
- algorithms (array, опционально) - список используемых алгоритмов

Запрос:
```
{
  "query": "город Москва, улица Ленина дом 3",
  "top_n": 5,
  "weights": {
    "dl": 1.0,
    "bm25": 1.0
  },
  "algorithms": []
}
```

Ответ:
```
{
  "searched_address": "город Москва, улица Ленина дом 3",
  "objects": [
    {
      "locality": "Москва",
      "street": "улица Ленина дом 3",
      "number": "",
      "lat": 55.751244,
      "lon": 37.618423,
      "score": 0.95
    }
  ]
}
```

### 2. Обратное геокодирование (`GET /reverse`)

Определение адресов по координатам.

Параметры:
- lat (float, обязательный) - широта
- lon (float, обязательный) - долгота
- top_n (int, по умолчанию 1) - количество возвращаемых результатов
- radius_m (float, по умолчанию 200.0) - радиус поиска в метрах

Запрос:
```
GET /reverse?lat=55.751244&lon=37.618423&top_n=3&radius_m=300
```

Ответ:
```
{
  "query_point_lat": 55.751244,
  "query_point_lon": 37.618423,
  "objects": [
    {
      "locality": "Москва",
      "street": "улица Ленина дом 3",
      "number": "",
      "lat": 55.751244,
      "lon": 37.618423,
      "score": null,
      "distance_m": 15.5
    }
  ]
}
```

### 3. Сравнение адресов (`POST /compare`)

Оценка сходства и расстояния между двумя адресами.

Запрос:
```
{
  "address_1": "город Москва, улица Ленина дом 3",
  "address_2": "город Москва, улица Ленина дом 5",
  "weights": {
    "dl": 1.0,
    "bm25": 1.0
  },
  "algorithms": []
}
```

Параметры ответа:
- distance_m - расстояние между адресами в метрах (формула Haversine)
- similarity - коэффициент сходства (0.0 - 1.0), вычисляется как max(0.0, 1.0 - distance_m / 1000.0)

Ответ:
```
{
  "address_1": "город Москва, улица Ленина дом 3",
  "address_2": "город Москва, улица Ленина дом 5",
  "distance_m": 45.2,
  "similarity": 0.955,
  "point_1": {
    "locality": "Москва",
    "street": "улица Ленина дом 3",
    "number": "",
    "lat": 55.751244,
    "lon": 37.618423,
    "score": 0.98
  },
  "point_2": {
    "locality": "Москва",
    "street": "улица Ленина дом 5",
    "number": "",
    "lat": 55.751300,
    "lon": 37.618500,
    "score": 0.97
  }
}
```

## Алгоритмы

### Дамерау-Левенштейн
Алгоритм для вычисления расстояния редактирования между строками. Учитывает вставки, удаления, замены и транспозиции символов.
### BM25
Алгоритм ранжирования для текстового поиска, основанный на вероятностной модели. Эффективен для поиска по большим коллекциям документов.
### Комбинирование алгоритмов
Результаты обоих алгоритмов объединяются с учетом весов. Финальный score вычисляется как среднее взвешенное значение.

## Структура проекта

```
besthack-final-2025/
├── app/                    # FastAPI приложение и эндпоинты
├── geocoder/               # Основная логика геокодирования
├── data/                   # Датасет
├── osmpbf_parser/          # Конвертер в csv на Golang
├── requirements.txt        # Зависимости проекта
├── Dockerfile
└── README.md               # Документация
```
